; Changes:
; * removed: 0
; * added: 1
; * swaps: 1
; * negated predicates: 1
; * swapped branches: 1
; * calls to id fun: 3
(letrec ((maak-teller (lambda ()
                        (let ((result 0))
                           (<change>
                              ()
                              result)
                           (letrec ((toets (lambda (bedrag)
                                             (set! result (+ result bedrag))))
                                    (reset (lambda ()
                                             (set! result 0)))
                                    (dispatch (lambda (msg)
                                                (if (eq? msg 'toets)
                                                   toets
                                                   (if (eq? msg 'lees)
                                                      result
                                                      (if (eq? msg 'reset)
                                                         (reset)
                                                         (error "wrong message")))))))
                              dispatch))))
         (maak-winkelkassa (lambda ()
                             (let ((saldo (maak-teller))
                                   (te-betalen (maak-teller))
                                   (ingetoetst 'product)
                                   (ontvangen 0))
                                (<change>
                                   (letrec ((toets (lambda (type bedrag)
                                                     (set! ingetoetst type)
                                                     (if (eq? type 'product)
                                                        ((te-betalen 'toets) bedrag)
                                                        (if (eq? type 'ontvangen)
                                                           (set! ontvangen bedrag)
                                                           (error "wrong type")))))
                                            (enter (lambda ()
                                                     (if (eq? ingetoetst 'product)
                                                        (te-betalen 'lees)
                                                        (let ((wisselgeld (- ontvangen (te-betalen 'lees))))
                                                           ((saldo 'toets) (te-betalen 'lees))
                                                           (te-betalen 'reset)
                                                           wisselgeld))))
                                            (inhoud (lambda ()
                                                      (saldo 'lees)))
                                            (afsluiten (lambda ()
                                                         (let ((teruggeven saldo))
                                                            (set! saldo 0)
                                                            teruggeven)))
                                            (dispatch (lambda (msg)
                                                        (if (eq? msg 'toets)
                                                           toets
                                                           (if (eq? msg 'enter)
                                                              (enter)
                                                              (if (eq? msg 'inhoud)
                                                                 (inhoud)
                                                                 (if (eq? msg 'afsluiten)
                                                                    (afsluiten)
                                                                    (error "wrong message"))))))))
                                      dispatch)
                                   ((lambda (x) x)
                                      (letrec ((toets (lambda (type bedrag)
                                                        (set! ingetoetst type)
                                                        (<change>
                                                           (if (eq? type 'product)
                                                              ((te-betalen 'toets) bedrag)
                                                              (if (eq? type 'ontvangen)
                                                                 (set! ontvangen bedrag)
                                                                 (error "wrong type")))
                                                           ((lambda (x) x)
                                                              (if (eq? type 'product)
                                                                 ((te-betalen 'toets) bedrag)
                                                                 (if (eq? type 'ontvangen)
                                                                    (set! ontvangen bedrag)
                                                                    (error "wrong type")))))))
                                               (enter (lambda ()
                                                        (<change>
                                                           (if (eq? ingetoetst 'product)
                                                              (te-betalen 'lees)
                                                              (let ((wisselgeld (- ontvangen (te-betalen 'lees))))
                                                                 ((saldo 'toets) (te-betalen 'lees))
                                                                 (te-betalen 'reset)
                                                                 wisselgeld))
                                                           ((lambda (x) x)
                                                              (if (eq? ingetoetst 'product)
                                                                 (<change>
                                                                    (te-betalen 'lees)
                                                                    (let ((wisselgeld (- ontvangen (te-betalen 'lees))))
                                                                       ((saldo 'toets) (te-betalen 'lees))
                                                                       (te-betalen 'reset)
                                                                       wisselgeld))
                                                                 (<change>
                                                                    (let ((wisselgeld (- ontvangen (te-betalen 'lees))))
                                                                       ((saldo 'toets) (te-betalen 'lees))
                                                                       (te-betalen 'reset)
                                                                       wisselgeld)
                                                                    (te-betalen 'lees)))))))
                                               (inhoud (lambda ()
                                                         (saldo 'lees)))
                                               (afsluiten (lambda ()
                                                            (let ((teruggeven saldo))
                                                               (set! saldo 0)
                                                               teruggeven)))
                                               (dispatch (lambda (msg)
                                                           (if (<change> (eq? msg 'toets) (not (eq? msg 'toets)))
                                                              toets
                                                              (if (eq? msg 'enter)
                                                                 (enter)
                                                                 (if (eq? msg 'inhoud)
                                                                    (inhoud)
                                                                    (if (eq? msg 'afsluiten)
                                                                       (afsluiten)
                                                                       (error "wrong message"))))))))
                                         dispatch))))))
         (teller (maak-teller))
         (winkelkassa (maak-winkelkassa)))
   ((winkelkassa 'toets) 'product 20)
   (<change>
      ((teller 'toets) 20)
      ((winkelkassa 'toets) 'product 5))
   (<change>
      ((winkelkassa 'toets) 'product 5)
      ((teller 'toets) 20))
   (if (= (teller 'lees) 20)
      (if (begin (teller 'reset) (= (teller 'lees) 0))
         (if (= (winkelkassa 'enter) 25)
            (if (= (begin ((winkelkassa 'toets) 'product 10) (winkelkassa 'enter)) 35)
               (if (begin ((winkelkassa 'toets) 'ontvangen 50) (= (winkelkassa 'enter) 15))
                  (= (winkelkassa 'inhoud) 35)
                  #f)
               #f)
            #f)
         #f)
      #f))